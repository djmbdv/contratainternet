var array_plan_id=[];var array_plan_value=[];var array_plan_titles=[];var array_selector=[];var global_symbol='';var global_decimal=',';var global_thousand='.';var global_precision=2;(function($){Drupal.behaviors.combo_creator={attach:function(context,settings){global_thousand=Drupal.settings.combo_creator.thousand_separator;global_decimal=Drupal.settings.combo_creator.decimal_separator;global_precision=Drupal.settings.combo_creator.decimal_precision;}}})(jQuery);function init_combo_creator(){(function($){accounting.settings={currency:{symbol:global_symbol,format:"%s%v",decimal:global_decimal,thousand:global_thousand,precision:global_precision},number:{precision:global_precision,thousand:global_thousand,decimal:global_decimal}}
$('.total_plan').each(function(index,item){$(this).text(accounting.formatMoney(accounting.unformat($(this).text(),global_decimal)));});var _tmp_price=$('#higlighted span.price > span').text();var _tmp_decimas=$('#higlighted span.price > sub.decimas span').text();var _temp_font_size=0;if(_tmp_decimas.length>0){_tmp_price+=global_decimal+_tmp_decimas;}
_tmp_price=accounting.formatMoney(accounting.unformat(_tmp_price,global_decimal));var _tmp_price_array=_tmp_price.split(global_decimal);$('#higlighted span.price > span').text(_tmp_price_array[0]);if(_tmp_price_array.length>1){$('#higlighted span.price > sub.decimas span').text(_tmp_price_array[1]);}else{_temp_font_size+=10;}
var _temp_price_len=_tmp_price_array[0].length;switch(_temp_price_len){case 7:_temp_font_size+=40;break;case 6:_temp_font_size+=50;break;case 5:_temp_font_size+=60;break;case 4:_temp_font_size+=70;break;case 3:_temp_font_size+=80;break;case 2:_temp_font_size+=90;break;}
$('#higlighted span.price').css('font-size',_temp_font_size);})(jQuery);}
function get_plan(selector,plan_id,solution_id,field_currency,table_id,more_less,product_id)
{(function($){var input=$(this);var selector_plan='value_'+selector;var value_plan=$('.'+selector_plan+' span').text();var solution=$('#solution_id_'+solution_id).text();var product=$('#producto_id_'+product_id).text();var description=$('.description_'+plan_id+'').text();var title=solution+' / '+description;var total_value;var character_value;value_plan=accounting.unformat(value_plan,global_decimal);$('.table-'+table_id+' tr').each(function(){var character_input=$(this).find('.'+selector+' input ');if(character_input&&character_input.attr('type')==='text'){character_value=character_input.val();}});if(character_value!=='0'&&character_value){var total_plan=parseFloat(character_value*value_plan);title+='/ Lineas '+character_value+'';}else{var total_plan=value_plan;}
plan_exist(total_plan,plan_id,title,selector,more_less);add_plan(field_currency);})(jQuery);}
function add_plan(field_currency)
{(function($){var data=get_data(field_currency);$('#gran_total').html('<span>'+field_currency+'</span>'+data[0]);$('#body_combo').html(data[1]);})(jQuery);}
function plan_exist(value_plan,plan_id,title,selector,more_less)
{(function($){var primera_vez=false;if(array_plan_id.length===0){primera_vez=true;array_plan_id.push(plan_id);array_plan_value.push(value_plan);array_plan_titles.push(title);array_selector.push(selector);}
if(primera_vez===false&&array_plan_id.length>0){if(!$('.'+selector+'').is(':checked')){if(array_plan_id.indexOf(plan_id)!==-1){var index=array_plan_id.indexOf(plan_id);array_plan_id.splice(index,1);array_plan_value.splice(index,1);array_plan_titles.splice(index,1);array_selector.splice(index,1);}}
if($('.'+selector+'').is(':checked')){if(array_plan_id.indexOf(plan_id)===-1){array_plan_id.push(plan_id);array_plan_value.push(value_plan);array_plan_titles.push(title);array_selector.push(selector)}}
if(more_less==='1'){var index=array_plan_id.indexOf(plan_id);array_plan_id.splice(index,1);array_plan_value.splice(index,1);array_plan_titles.splice(index,1);array_selector.splice(index,1);array_plan_id.push(plan_id);array_plan_value.push(value_plan);array_plan_titles.push(title);array_selector.push(selector)}}})(jQuery);}
function get_data(field_currency)
{var total=0;var html="";var data=new Array();var row_class="";var summary_combo='';var tables_id=[];var cols_id=[];var titles_summary=[];var price=[];for(var i=0;i<array_plan_id.length;i++)
{var value=accounting.formatMoney(parseFloat(array_plan_value[i]));var data_plan=array_plan_id[i].split('_');tables_id.push(data_plan[0]);cols_id.push(data_plan[1]);titles_summary.push(array_plan_titles[i]);price.push(value)
total+=parseFloat(array_plan_value[i]);if(i%2===0){row_class='odd';}else{row_class='even';}
var solution_name=array_plan_titles[i].split('/')[0];var description_name=array_plan_titles[i].split('/')[1];var character='';console.log(array_plan_titles[i].split('/'));if(array_plan_titles[i].split('/')[2]){character=' / '+array_plan_titles[i].split('/')[2];}
html+='<tr class="'+row_class+' '+array_selector[i]+'">'+'<td class="name"><a data-tab="'+array_selector[i]+'" class="delete" onclick="remove_services(\''+array_selector[i]+'\', \''+array_plan_id[i]+'\', \''+field_currency+'\') "></a><b>'+solution_name+'</b> / <span>'+description_name+character+'</span></td>'+'<td class="value"><span>'+field_currency+'</span>'+value+'</td>'+'</tr>';summary_combo+=array_plan_titles[i]+'###'+value+'///';}
append_data_plans(cols_id,tables_id,titles_summary,field_currency,accounting.formatMoney(total),price);data[0]=accounting.formatMoney(total);data[1]=html;return data;}
function remove_services(selector,plan_id,field_currency)
{(function($){var table_id=plan_id.split('_')[0];$('.'+selector+'').prop("checked",false);$("."+selector).each(function(){$(this).removeClass("active");});$(".result-combo table tr."+selector).remove();if(array_plan_id.indexOf(plan_id)!==-1){var index=array_plan_id.indexOf(plan_id);array_plan_id.splice(index,1);array_plan_value.splice(index,1);array_plan_titles.splice(index,1);array_selector.splice(index,1);var data=get_data(field_currency);$('#gran_total').html('<span>'+field_currency+'</span>'+data[0]);}})(jQuery);}
function append_data_to_form(summary_combo)
{(function($){$('#summary_combo').val(summary_combo);})(jQuery);}
function append_data_plans(cols_id,tables_id,titles_summary,field_currency,total,price){(function($){$('#tables_id').val(tables_id);$('#cols_id').val(cols_id);$('#titles_summary').val(titles_summary);$('#currency').val(field_currency);$('#total').val(total);$('#price').val(price);})(jQuery);}
function get_total(selector,plan_id)
{(function($){$('.table-'+plan_id+' tr').each(function(){if($(this).find('.'+selector+' span .total')){var total=$(this).find('.'+selector+' span .total').text();return total;}});})(jQuery);}
jQuery(document).ready(function(){init_combo_creator();});